<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Insights</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="dashboard-body">

    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="{{ url_for('static', filename='images/mosspay_logo.png') }}" alt="MossPay" class="sidebar-logo">
        </div>
        <ul class="sidebar-menu">
            <li><a href="{{ url_for('vendor_dashboard') }}"><i class="fas fa-th-large"></i> Dashboard</a></li>
            <li><a href="{{ url_for('manage_profile') }}"><i class="fas fa-user-circle"></i> Manage Profile</a></li>
            <li><a href="{{ url_for('manage_items') }}"><i class="fas fa-box-open"></i> Manage Items</a></li>
            <li><a href="{{ url_for('manage_offers') }}"><i class="fas fa-tags"></i> Manage Offers</a></li>
            <li class="active"><a href="{{ url_for('customer_insights') }}"><i class="fas fa-chart-line"></i> Customer Insights</a></li>
            <li><a href="{{ url_for('transaction_history') }}"><i class="fas fa-history"></i> Transaction History</a></li>
            <li><a href="{{ url_for('my_subscription') }}"><i class="fas fa-gem"></i> My Subscription</a></li>
        </ul>
        <div class="sidebar-footer">
           <a href="{{ url_for('vendor_settings') }}"><i class="fas fa-cog"></i> Settings</a>
            <a href="{{ url_for('vendor_logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </nav>

    <div class="overlay" id="overlay"></div>

    <main class="main-content">
        <header class="topbar">
            <div class="topbar-left">
                <a href="{{ url_for('vendor_dashboard') }}" class="icon-btn">
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="topbar-right">
                <a href="#" class="btn-topbar">View Insights</a>
                <a href="#" class="btn-topbar btn-green-solid">Create New Offer</a>
            </div>
        </header>
        
        <div class="content-wrapper">
            <h1 class="content-title">Customer Insights</h1>
            
            <div class="stats-grid-vendor">
                <div class="card card-stat-vendor">
                    <p>Total Sales (All Time)</p>
                    <strong>₹{{ "%.2f"|format(total_sales) }}</strong>
                    <small>from {{ total_customers }} customers</small>
                </div>
                <div class="card card-stat-vendor">
                    <p>Total Customers</p>
                    <strong>{{ total_customers }}</strong>
                    <small>Unique customers via MossPay</small>
                </div>
                <div class="card card-stat-vendor">
                    <p>Total CO₂ Saved by Customers</p>
                    <strong>{{ total_co2|round(1) }} kg</strong>
                    <small>Est. total impact</small>
                </div>
            </div>

            <div class="bill-generator-layout"> 
                <div class="card item-list-panel">
                    <h3>Your Top 5 Products</h3>
                    <ul id="item-list">
                        {% if top_items %}
                            {% for item_name, total_sold in top_items %}
                            <li class="item-list-entry">
                                <div class="item-info">
                                    <strong>{{ item_name }}</strong>
                                </div>
                                <div class="item-controls">
                                    <span class="insight-value">{{ total_sold }} sold</span>
                                </div>
                            </li>
                            {% endfor %}
                        {% else %}
                            <p class="empty-bill">No sales data yet.</p>
                        {% endif %}
                    </ul>
                </div>

                <div class="card item-list-panel">
                    <h3>Customer Age Demographics</h3>
                    <ul id="item-list">
                        {% for range, count in age_buckets.items() %}
                        <li class="item-list-entry">
                            <div class="item-info">
                                <strong>{{ range }}</strong>
                            </div>
                            <div class="item-controls">
                                <span class="insight-value">{{ count }} users</span>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

            </div>
        </div>
    </main>
    
    </body>
</html>